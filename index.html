<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Calendario Q</title>
<style>
    body {
        margin: 0;
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: linear-gradient(135deg, #6a0dad, #00aa66);
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* MENU DATA */
    #topbar {
        padding: 15px;
        background: rgba(255,255,255,0.2);
        display: flex;
        justify-content: center;
        backdrop-filter: blur(4px);
    }

    #container {
        display: flex;
        flex: 1;
        padding: 20px;
        gap: 20px;
    }

    .side, .right {
        width: 30%;
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }

    .side img, .right img {
        max-width: 100%;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }

    #main {
        width: 40%;
        text-align: center;
        color: white;
    }

    #phrase {
        font-weight: bold;
        margin-top: 15px;
    }

    /* POPUP DISCLAIMER */
    #popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #popupContent {
        background: purple;
        color: white;
        padding: 30px;
        width: 60%;
        border-radius: 15px;
        font-size: 20px;
        text-align: center;
        box-shadow: 0 0 20px black;
    }

    #popupContent button {
        margin-top: 25px;
        padding: 12px 25px;
        font-size: 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="popup" style="display:flex;">
    <div id="popupContent">
        <div id="disclaimerText">Caricamento...</div>
        <button onclick="closePopup()">OK</button>
    </div>
</div>

<div id="topbar">
    <input type="date" id="datePicker" min="2025-12-11" max="2026-12-31">
</div>

<div id="container">
    <div class="side"><img id="leftImg" src=""></div>

    <div id="main">
        <h2 id="question"></h2>

        <input type="text" id="answerInput" placeholder="Inserisci la risposta">
        <button onclick="checkAnswer()">Invia</button>

        <div id="feedback"></div>
        <div id="phrase"></div>
    </div>

    <div class="right"><img id="rightImg" src=""></div>
</div>

<script>
let data = {};
let currentDate = null;
let popupForced = false;

async function loadData() {
    const res = await fetch("Q.json");
    data = await res.json();
}

function showPopup(text) {
    document.getElementById("disclaimerText").innerText = text;
    document.getElementById("popup").style.display = "flex";
}

function closePopup() {
    document.getElementById("popup").style.display = "none";
    popupForced = false;
}

function resetContent() {
    document.getElementById("question").innerText = "";
    document.getElementById("feedback").innerText = "";
    document.getElementById("phrase").innerText = "";
    document.getElementById("phrase").style.display = "none";

    document.getElementById("leftImg").src = "placeholder.jpg";
    document.getElementById("rightImg").src = "placeholder.jpg";
    document.querySelector(".right").style.visibility = "hidden";
}

function loadImages(date) {
    const leftPath = `Sx/${date}.jpg`;
    const rightPath = `Dx/${date}.jpg`;

    const leftImg = document.getElementById("leftImg");
    const rightImg = document.getElementById("rightImg");

    leftImg.src = leftPath;
    rightImg.src = rightPath;

    leftImg.onerror = () => leftImg.src = "placeholder.jpg";
    rightImg.onerror = () => rightImg.src = "placeholder.jpg";
}

function loadQuestion(date) {
    resetContent();

    const today = new Date().toISOString().split("T")[0];

    // controllo data futura
    if (date > today) {
        popupForced = true;
        showPopup("Non spiociare il futuro!!!");
        return;
    }

    const q = data[date];
    if (!q) {
        showPopup("Nessun dato disponibile.");
        return;
    }

    showPopup(q.disclaimer);

    document.getElementById("question").innerText = q.question;

    loadImages(date);
}

function checkAnswer() {
    const input = document.getElementById("answerInput").value.trim();
    const q = data[currentDate];
    const feedbackEl = document.getElementById("feedback");
    const phraseEl = document.getElementById("phrase");

    if (!q) return;

    if (input === q.answer) {
        feedbackEl.innerHTML = "";
        phraseEl.innerText = q.phrase;
        phraseEl.style.color = "limegreen";
        phraseEl.style.display = "block";
        document.querySelector(".right").style.visibility = "visible";
    } else {
        feedbackEl.innerHTML = '<span style="color:#ff3333">Ops... Risposta sbagliata!!!</span>';
        phraseEl.innerText = "";
        phraseEl.style.display = "none";
        document.querySelector(".right").style.visibility = "hidden";
    }
}

document.getElementById("datePicker").addEventListener("change", (e) => {
    currentDate = e.target.value;
    loadQuestion(currentDate);
});

// INIT
window.onload = async () => {
    await loadData();
    const start = "2025-12-11";
    document.getElementById("datePicker").value = start;
    currentDate = start;
    loadQuestion(start);
};
</script>

</body>
</html>
