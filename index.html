<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E' quello in cinma?</title>
    <style>
        body {
           font-family: Arial, sans-serif;
            margin: 0; /* Rimuovi il margine predefinito per usare l'intera altezza */
            
            /* NUOVE PROPRIET√Ä PER IL CENTRAGGIO VERTICALE */
            display: flex;
            flex-direction: column; /* Imposta l'asse principale su colonna */
            align-items: center;    /* Centra orizzontalmente i contenuti */
            justify-content: center;  /* Centra verticalmente i contenuti */
            min-height: 100vh;      /* Forza il body ad occupare l'intera altezza della finestra */

            background: linear-gradient(to bottom right, #f8f8f8, #ffffff);
            background-attachment: fixed; /* Assicura che lo sfondo non si muova allo scroll */
        }
        #container {
            display: flex; /* Mantiene la flessibilit√† per allineare gli elementi fianco a fianco */
            width: 100%;
            max-width: 900px;
            justify-content: space-between; /* Distribuisce lo spazio tra i tre elementi */
            align-items: center;
            margin-top: 20px;
        }
        #left-img, #right-img {
            width: 30%; /* Le due immagini occupano meno spazio (30% ciascuna) */
            min-height: 300px;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        #center-qa {
            width: 35%; /* La colonna centrale (domanda/risposta) occupa il 35% */
            text-align: center;
            padding: 0 10px; /* Piccolo padding per non attaccare i bordi */
        }
        #left-img img, #right-img img {
            width: 100%;
        }
       
        
        /* Assicuriamo che la modale sia SEMPRE visibile all'inizio */
        #disclaimer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex; /* La modale √® visibile di default */
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Assicuriamo che sia sopra ogni cosa */
        }
        #disclaimer-box {
            background: violet;
            padding: 20px;
            max-width: 500px;
            border-radius: 8px;
            text-align: center;
        }

        .feedback-correct {
            color: green;
            font-weight: bold;
        }
        .feedback-error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="disclaimer-modal">
    <div id="disclaimer-box">
        <p id="disclaimer-text">Caricamento del disclaimer...</p>
        <button onclick="closeDisclaimer()">OK</button>
    </div>
</div>

<h2>Domanda del Giorno</h2>
<input type="date" id="date-selector" onchange="changeDate()" />

<div id="container">
    
    <div id="left-img">Immagine sinistra</div>
    
    <div id="center-qa">
        <h3 id="question">Caricamento...</h3>
        <input type="text" id="answer" placeholder="Risposta" />
        <button onclick="checkAnswer()">Invia</button>
        <p id="feedback"></p>
    </div>
    
    <div id="right-img"></div>
</div>

<script>
let DATA = {};
let currentDate = "";
let results = JSON.parse(localStorage.getItem("results_domanda_giorno") || "{}");

fetch("Q.json")
    .then(r => {
        if (!r.ok) throw new Error("Errore nel caricamento di Q.json: " + r.statusText);
        return r.json();
    })
    .then(json => {
        DATA = json;
        init();
    })
    .catch(err => {
        console.error("Errore fatale:", err);
        document.getElementById("disclaimer-text").innerText = "Errore nel caricamento dei dati. Controlla la console.";
    });


function init() {
    const today = new Date();
    const yyyy = today.getFullYear(); 
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    currentDate = `${yyyy}-${mm}-${dd}`;

    document.getElementById("date-selector").value = currentDate;
    loadDay(currentDate);
}

function closeDisclaimer() {
    document.getElementById("disclaimer-modal").style.display = "none";
}

function showDisclaimer() {
    document.getElementById("disclaimer-modal").style.display = "flex";
}

function changeDate() {
    currentDate = document.getElementById("date-selector").value;
    loadDay(currentDate);
}

function loadDay(dateStr) {
    // 1. PREPARAZIONE DELLE DATE PER IL CONFRONTO
    const today = new Date();
    // Formato YYYY/MM/DD per creare un Date object affidabile solo con la data di oggi
    const todayStr = today.getFullYear() + '/' + String(today.getMonth() + 1).padStart(2, '0') + '/' + String(today.getDate()).padStart(2, '0');
    
    // Converte le stringhe in Date objects (solo la data, senza orario)
    const selectedDate = new Date(dateStr.replace(/-/g, '/'));
    const currentDateOnly = new Date(todayStr);
    
    // Ottiene gli elementi per manipolazione
    const answerInput = document.getElementById("answer");
    const checkButton = document.querySelector("#center-qa button");
    const feedbackElement = document.getElementById("feedback");
    const questionElement = document.getElementById("question");
    
    // Eseguire il reset dei contenuti dinamici e dello stile
    document.getElementById("left-img").innerHTML = `Immagine sinistra`; // Reset immagine Sx
    document.getElementById("right-img").innerHTML = "";
    answerInput.value = "";
    feedbackElement.innerText = "";
    feedbackElement.classList.remove("feedback-correct", "feedback-error");
    
    
    // 2. CONTROLLO DATA FUTURA
    // Se la data selezionata (in millisecondi) √® maggiore di oggi (in millisecondi)
    if (selectedDate.getTime() > currentDateOnly.getTime()) {
        // Disabilita interazione e mostra errore
        answerInput.disabled = true;
        checkButton.disabled = true;
        
        questionElement.innerText = "‚ö†Ô∏è Non puoi visualizzare le domande future.";
        document.getElementById("disclaimer-text").innerText = "Ehi tu, furbetta! Non spiociare il futuro";
        showDisclaimer();
        
        document.getElementById("left-img").innerHTML = `<div style="text-align:center; padding: 20px;">üìÖ Data Futura</div>`;
        return; // Esce dalla funzione
    }
    
    // 3. CARICAMENTO NORMALE (Data odierna o Passata)
    
    // Riabilita interazione
    answerInput.disabled = false;
    checkButton.disabled = false;
    
    const data = DATA[dateStr];

    // Immagine sinistra
    document.getElementById("left-img").innerHTML = `<img src="Sx/${dateStr}.jpg" alt="Immagine sx" onerror="this.onerror=null; this.src='Sx/placeholder_sx.jpg'; this.alt='Immagine mancante'">`;

    if (!data) {
        questionElement.innerText = "Nessuna domanda trovata.";
        document.getElementById("disclaimer-text").innerText = "Nessuna domanda trovata per questa data.";
        showDisclaimer();
        return;
    }

    // Carica Disclaimer e Domanda
    document.getElementById("disclaimer-text").innerText = data.disclaimer || "Ti amo";
    showDisclaimer();
    
    questionElement.innerText = data.question;

    // Controllo se √® gi√† stata risolta
    if (results[dateStr] === true) {
        showRightImage(dateStr);
        feedbackElement.innerText = `Hai gi√† risposto correttamente: "${data.answer}"`;
        feedbackElement.classList.add("feedback-correct");
    }
}

function checkAnswer() {
    const data = DATA[currentDate];

    // Controlla se ci sono dati per il giorno corrente
    if (!data) {
        document.getElementById("feedback").innerText = "Errore: Nessuna domanda caricata.";
        return;
    }

    const userAnswer = document.getElementById("answer").value.trim().toLowerCase();
    const correct = data.answer.toString().trim().toLowerCase();

    // Ottieni l'elemento feedback una sola volta
    const feedbackElement = document.getElementById("feedback");

    if (userAnswer === correct) {
        // CORRETTO (VERDE)
        feedbackElement.innerText = data.phrase;
        
        // Aggiungi la classe verde e rimuovi quella rossa
        feedbackElement.classList.add("feedback-correct");
        feedbackElement.classList.remove("feedback-error");

        results[currentDate] = true;
        localStorage.setItem("results_domanda_giorno", JSON.stringify(results));
        showRightImage(currentDate);
    } else {
        // ERRATO (ROSSO)
        feedbackElement.innerText = "Risposta errata, buuuu. Riprova!";
        
        // Aggiungi la classe rossa e rimuovi quella verde
        feedbackElement.classList.add("feedback-error");
        feedbackElement.classList.remove("feedback-correct");
    }
}

function showRightImage(dateStr) {
    document.getElementById("right-img").innerHTML = `<img src="Dx/${dateStr}.jpg" alt="Immagine dx" onerror="this.onerror=null; this.src='Dx/placeholder_dx.jpg'; this.alt='Immagine mancante'">`;
}
</script>

</body>
</html>











